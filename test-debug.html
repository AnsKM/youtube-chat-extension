<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="content/styles.css">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .debug-output {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>Markdown Test</h2>
        <div id="input" class="debug-output"></div>
        <h3>Output:</h3>
        <div id="output"></div>
    </div>

    <script>
        // Test content from the screenshots
        const testContent = `Based on the video transcript, here's a step-by-step process to write LinkedIn posts that get views:

1. Find a Core Insight (Step 1)

**What it is:** A unique, fresh, and interesting perspective. Avoid copying others to build a personal brand.

**How to find it:**
* Talk to your audience: Analyze questions they ask, problems they have, or dreams/objectives they want to achieve.
* Build in public: Take notes of your daily activities, experiments, events, or anything you're trying.

2. Find a Main Idea/Angle (Step 2)

Key Rule: One post equals one idea.

**How to do it:** Take your core insight and give it a specific angle, like a journalist.

Three Roles of a Hook:
1. Trigger interest: Make people feel "oh, this is interesting, I want to know more."
2. Tell what the post is about: Clearly state the topic.
3. Make the reader feel concerned: They need to understand it's about *them*.`;

        // Show input
        document.getElementById('input').textContent = testContent;

        // Load the script content inline for testing
        function formatMessage(content) {
            const features = {
                headers: true,
                lists: true,
                codeBlocks: true,
                inlineCode: true,
                taskLists: true,
                blockquotes: true,
                horizontalRules: true,
                links: true,
                highlighting: true,
                keyboardShortcuts: true,
                bold: true,
                lineBreaks: true,
                subheadings: true
            };

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            const codeStore = [];
            let codeIndex = 0;

            // Process section headers BEFORE escaping HTML
            if (features.headers) {
                console.log('Looking for section headers...');
                content = content.replace(/^(\d+)\.\s+(.+?)\s*\(Step\s+\d+\)$/gm, (match, num, title) => {
                    console.log('Found section header:', match);
                    return `__SECTION_HEADER__${num}. ${title}__END_SECTION_HEADER__`;
                });
            }

            // Process subheadings with bold BEFORE escaping
            if (features.subheadings) {
                console.log('Looking for bold subheadings...');
                content = content.replace(/^\*\*((?:What|How|When|Why|Where|Who|Key|Hard|Three|Advice|Pro|Bonus|Types)(?:\s+\w+)*\s*:)\*\*(.*)$/gm, (match, heading, rest) => {
                    console.log('Found bold subheading:', match);
                    return '__SUBHEADING__' + heading + '__END_SUBHEADING__' + rest;
                });
            }

            // Escape HTML
            content = escapeHtml(content);

            // Replace placeholders
            content = content.replace(/__SECTION_HEADER__(.+?)__END_SECTION_HEADER__/g, (match, text) => {
                return `<h3 class="markdown-section-header">${text}</h3>`;
            });

            content = content.replace(/__SUBHEADING__(.+?)__END_SUBHEADING__/g, (match, text) => {
                return `<div class="markdown-subheading">${text}</div>`;
            });

            // Other subheadings
            content = content.replace(/^((?:What|How|When|Why|Where|Who|Key|Hard|Three|Advice|Pro|Bonus|Types|Importance|Ending)(?:\s+\w+)*\s*:)(.*)$/gm, 
                '<div class="markdown-subheading">$1</div>$2');

            // Lists
            content = content.replace(/^[\*\-]\s+(.+)$/gm, '<li class="markdown-ul-item">$1</li>');
            content = content.replace(/(<li class="markdown-ul-item">[\s\S]*?<\/li>(<br>)?)+/g, (match) => {
                const items = match.replace(/<br>/g, '');
                return `<ul class="markdown-ul">${items}</ul>`;
            });

            // Bold
            content = content.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

            // Line breaks
            content = content.replace(/\n/g, '<br>');

            return content;
        }

        // Apply formatting
        const formatted = formatMessage(testContent);
        document.getElementById('output').innerHTML = formatted;
    </script>
</body>
</html>